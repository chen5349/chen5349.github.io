
<!DOCTYPE html>
<html lang="en">
    
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="Personal Blog">
    <title>Visualization - choropleth-mapbox + plotly + python - Personal Blog</title>
    <meta name="author" content="Wenna Chen">
    
    
    
        
            <link rel="alternate" type="application/atom+xml" title="RSS" href="/atom.xml">
        
    
    <script type="application/ld+json">{"@context":"http://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Wenna Chen","sameAs":["https://github.com/","http://stackoverflow.com/users","https://twitter.com/","https://facebook.com/","https://plus.google.com/","https://www.linkedin.com/profile/","mailto"],"image":"https://res.cloudinary.com/chen5349/image/upload/v1624887373/profile_wx71r5.jpg"},"articleBody":"\n\nThis post will introduce how to visualize the continuous variable on the map with the use of choropleth_mapbox, a mighty tool to realize animation.\n\n\n\n\nStep 1. import all needed packages1234567891011import numpy as npimport pandas as pdimport chart_studio.plotly as pyimport plotly.tools as tlsimport plotly.express as pximport jsonfrom IPython.core.interactiveshell import InteractiveShellInteractiveShell.ast_node_interactivity = &quot;all&quot;\n\n\n\nStep 2. import json file from existing fileThe .json file could be converted from shp. file. I convert it directly by using QGIS.\nMore conveniently, you can use package shapefile in python to finish the conversion. Check reference for more detail.\n1234with open(&#x27;Simplify_GeoJSON_CHNcity.json&#x27;) as f:  CHN_cities = json.load(f)# below is the alternative to load the json file# CHN_cities = json.load(open(&quot;GeoJSON_CHNcity.geojson&quot;,&quot;r&quot;))\n\n1234# examine the fearue of the json fileCHN_cities[&quot;features&quot;][0].keys()CHN_cities[&quot;features&quot;][0][&quot;properties&quot;]CHN_cities[&quot;features&quot;][0]    \n\n\n{‚Äòtype‚Äô: ‚ÄòFeature‚Äô, ‚Äògeometry‚Äô: {‚Äòtype‚Äô: ‚ÄòPolygon‚Äô,  ‚Äòcoordinates‚Äô: [[[116.12962341, 29.82485008],    [116.27577972, 29.79137039],    [116.4651413, 29.90048981],    [116.54703522, 29.9179039],    [116.58567047, 30.05631828],‚Ä¶\n\nYou could find out that the coordinates is in 8 decimal places, which will inflate the size of the map. Therefore, we need the following step.\nStep 3. make the json file smaller\nFirst, check If you have large GeoJSON files, such as over 20 or 30 MB. The map upload tends to be slow. And normally could not be uploaded to plotly account. \n\nThe easiest way is to use https://mapshaper.org/ to simplify the json file, to make the json file better less than 3MB. You would not lose necessary information because we here care about various coloration across regions.\n\nWhen you have already finish above two steps, your json file is already small enough. To make it even smaller, run following code to shrink it 10% or so. \n\n\n12345678910#Round off the locations to 2 decimal places (about 1.1 km accuracy)for i in range(0, len(CHN_cities[&quot;features&quot;])):    for j in range(0,len(CHN_cities[&quot;features&quot;][i][&#x27;geometry&#x27;][&#x27;coordinates&#x27;])):        try:            CHN_cities[&quot;features&quot;][i][&#x27;geometry&#x27;][&#x27;coordinates&#x27;][j] = np.round(np.array(CHN_cities[&quot;features&quot;][i][&#x27;geometry&#x27;][&#x27;coordinates&#x27;][j]),2)        except:            print(i,j)            # If you now check the coordinates again, you‚Äôll see that they have been rounded off to 2 decimal places:CHN_cities[&quot;features&quot;][0][&#x27;geometry&#x27;][&#x27;coordinates&#x27;][0][0]\n\n\narray([116.13,  29.82])\n\nStep 4. Visualization through choropleth_mapbox\nI have already prepared the df_EC for use, detail cleaning process is omitted here. \n\nWe need to ensure that the dataframe df_EC have the same location ‚Äúid‚Äù as geojson file. \n\nPlease check the the official websie for setting the parrrameters: https://plotly.github.io/plotly.py-docs/generated/plotly.express.choropleth_mapbox.html\n\n\n12345678910111213fig_Heterogeneity = px.choropleth_mapbox(df_EC,                     locations = &quot;id&quot;,                     geojson = CHN_cities,                     color = &quot;EC&quot;,                     mapbox_style=&quot;carto-positron&quot;, # carto-darkmatter&quot;,                    opacity = 0.8,color_continuous_midpoint = 0,zoom = 2.5,                    color_continuous_scale = px.colors.diverging.balance,                    labels=&#123;&#x27;EC&#x27;:&#x27;Environmental Heterogeneity&#x27;&#125;,                    center=&#123;&quot;lat&quot;: 38, &quot;lon&quot;: 104&#125;,                     range_color=(-2.5, 1.8) )#        zoom = 3,   )fig_Heterogeneity.update_layout(margin=&#123;&quot;r&quot;:0,&quot;t&quot;:0,&quot;l&quot;:0,&quot;b&quot;:0&#125;,height = 380, width = 759)fig_Heterogeneity.show()\n\nIn the default browser, we get the following image, indicating the environmental complexity across China. \n\n    \n    \n\n\n\n\nStep 5. Export the image as local htmlYou might want it.. Even though I don‚Äôt think it‚Äôs that useful\n12import plotly.io as piopio.write_html(fig_Heterogeneity, file=&#x27;figure.html&#x27;, auto_open=True)\n\n\n\nStep 6. Save the image on plotly account\nThe url in the plotly website can help you disseminate your work. The url can also be used in ppt  with animation. I will introduce the embeddment of it in my future blog.\n\nYou need to first go the this website for registering account. https://chart-studio.plotly.com/feed/#/\n\nInstallation of Chart Studio in python: https://plotly.com/python/getting-started-with-chart-studio/\n\nThen upload the image to your account\n\n\n1py.plot(fig_Heterogeneity, filename = &#x27;Environmental Heterogeneity&#x27;, auto_open=True)\n\nIt uploads the image online including the data on your plotly account.\nIf returned with the following error!! Go back to step 3 to shrink the size.\n\n‚ÄúThis file is too big! Your current subscription is limited to 524.288 KB uploads. For more information, please visit: https://plotly.com/get-pricing/.&quot;\n\nCheers!ü•≥\nThe following image depicts the environmental dispersion across China. Same steps above can get you this beautiful visualization. \n\n    \n    \n\n\n\n\nReferences: \nhttps://medium.com/tech-carnot/plotly-mapbox-interactive-choropleth-visualization-tutorial-957dcdbca90b\n","dateCreated":"2021-06-27T15:55:40+08:00","dateModified":"2021-07-01T03:20:04+08:00","datePublished":"2021-06-27T15:55:40+08:00","description":"\n\nThis post will introduce how to visualize the continuous variable on the map with the use of choropleth_mapbox, a mighty tool to realize animation.","headline":"Visualization - choropleth-mapbox + plotly + python","image":[],"mainEntityOfPage":{"@type":"WebPage","@id":"http://chen5349.github.io/2021/06/27/choropleth-mapbox/"},"publisher":{"@type":"Organization","name":"Wenna Chen","sameAs":["https://github.com/","http://stackoverflow.com/users","https://twitter.com/","https://facebook.com/","https://plus.google.com/","https://www.linkedin.com/profile/","mailto"],"image":"https://res.cloudinary.com/chen5349/image/upload/v1624887373/profile_wx71r5.jpg","logo":{"@type":"ImageObject","url":"https://res.cloudinary.com/chen5349/image/upload/v1624887373/profile_wx71r5.jpg"}},"url":"http://chen5349.github.io/2021/06/27/choropleth-mapbox/","keywords":"plotly, python, External Environment, choropleth-mapbox"}</script>
    <meta name="description" content="This post will introduce how to visualize the continuous variable on the map with the use of choropleth_mapbox, a mighty tool to realize animation.">
<meta property="og:type" content="blog">
<meta property="og:title" content="Visualization - choropleth-mapbox + plotly + python">
<meta property="og:url" content="http://chen5349.github.io/2021/06/27/choropleth-mapbox/index.html">
<meta property="og:site_name" content="Personal Blog">
<meta property="og:description" content="This post will introduce how to visualize the continuous variable on the map with the use of choropleth_mapbox, a mighty tool to realize animation.">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://res.cloudinary.com/chen5349/image/upload/v1624888725/landscape/wp5498288_tkbdrh.jpg">
<meta property="og:image" content="https://plotly.com/404.png">
<meta property="og:image" content="https://plotly.com/404.png">
<meta property="article:published_time" content="2021-06-27T07:55:40.000Z">
<meta property="article:modified_time" content="2021-06-30T19:20:04.119Z">
<meta property="article:author" content="Wenna Chen">
<meta property="article:tag" content="plotly">
<meta property="article:tag" content="python">
<meta property="article:tag" content="External Environment">
<meta property="article:tag" content="choropleth-mapbox">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://res.cloudinary.com/chen5349/image/upload/v1624888725/landscape/wp5498288_tkbdrh.jpg">
    
    
        
    
    
        <meta property="og:image" content="https://res.cloudinary.com/chen5349/image/upload/v1624887373/profile_wx71r5.jpg"/>
    
    
    
    
    <!--STYLES-->
    
<link rel="stylesheet" href="/assets/css/style-qy174myolakqkjmsxapcryckrzrdfbvfeo3d4t29qco30dtqyblzxnxb2vmq.min.css">

    <!--STYLES END-->
    

    

    
</head>

    <body>
        <div id="blog">
            <!-- Define author's picture -->


<header id="header" data-behavior="1">
    <i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i>
    <div class="header-title">
        <a
            class="header-title-link"
            href="/"
            aria-label=""
        >
            Personal Blog
        </a>
    </div>
    
        
            <a
                class="header-right-icon st-search-show-outputs"
                href="#search"
                aria-label="Open the link: /#search"
            >
        
        
            <i class="search fa-lg"></i>
        
        </a>
    
</header>

            <!-- Define author's picture -->



        
    

<nav id="sidebar" data-behavior="1">
    <div class="sidebar-container">
        
            <div class="sidebar-profile">
                <a
                    href="/#about"
                    aria-label="Read more about the author"
                >
                    <img class="sidebar-profile-picture" src="https://res.cloudinary.com/chen5349/image/upload/v1624887373/profile_wx71r5.jpg" alt="Author&#39;s picture"/>
                </a>
                <h4 class="sidebar-profile-name">Wenna Chen</h4>
                
                    <h5 class="sidebar-profile-bio"><p>Public Management Scholar</p>
</h5>
                
            </div>
        
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/"
                            
                            rel="noopener"
                            title="Home"
                        >
                        <i class="sidebar-button-icon fa fa-home" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Home</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/all-categories"
                            
                            rel="noopener"
                            title="Categories"
                        >
                        <i class="sidebar-button-icon fa fa-bookmark" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Categories</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/all-tags"
                            
                            rel="noopener"
                            title="Tags"
                        >
                        <i class="sidebar-button-icon fa fa-tags" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Tags</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/all-archives"
                            
                            rel="noopener"
                            title="Archives"
                        >
                        <i class="sidebar-button-icon fa fa-archive" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Archives</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link open-algolia-search"
                            href="#search"
                            
                            rel="noopener"
                            title="Search"
                        >
                        <i class="sidebar-button-icon fa fa-search" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Search</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="#about"
                            
                            rel="noopener"
                            title="About"
                        >
                        <i class="sidebar-button-icon fa fa-question" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">About</span>
                    </a>
            </li>
            
        </ul>
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="https://github.com/"
                            
                                target="_blank"
                            
                            rel="noopener"
                            title="GitHub"
                        >
                        <i class="sidebar-button-icon fab fa-github" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">GitHub</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="http://stackoverflow.com/users"
                            
                                target="_blank"
                            
                            rel="noopener"
                            title="Stack Overflow"
                        >
                        <i class="sidebar-button-icon fab fa-stack-overflow" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Stack Overflow</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="https://twitter.com/"
                            
                                target="_blank"
                            
                            rel="noopener"
                            title="Twitter"
                        >
                        <i class="sidebar-button-icon fab fa-twitter" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Twitter</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="https://facebook.com/"
                            
                                target="_blank"
                            
                            rel="noopener"
                            title="Facebook"
                        >
                        <i class="sidebar-button-icon fab fa-facebook" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Facebook</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="https://plus.google.com/"
                            
                                target="_blank"
                            
                            rel="noopener"
                            title="Google +"
                        >
                        <i class="sidebar-button-icon fab fa-google-plus" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Google +</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="https://www.linkedin.com/profile/"
                            
                                target="_blank"
                            
                            rel="noopener"
                            title="LinkedIn"
                        >
                        <i class="sidebar-button-icon fab fa-linkedin" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">LinkedIn</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/mailto"
                            
                            rel="noopener"
                            title="Mail"
                        >
                        <i class="sidebar-button-icon fa fa-envelope" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Mail</span>
                    </a>
            </li>
            
        </ul>
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/atom.xml"
                            
                            rel="noopener"
                            title="RSS"
                        >
                        <i class="sidebar-button-icon fa fa-rss" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">RSS</span>
                    </a>
            </li>
            
        </ul>
        
    </div>
</nav>

            
            <div id="main" data-behavior="1"
                 class="
                        hasCoverMetaIn
                        ">
                
<article class="post">
    
    
        <div class="post-header main-content-wrap text-left">
    
        <h1 class="post-title">
            Visualization - choropleth-mapbox + plotly + python
        </h1>
    
    
        <div class="post-meta">
    <time datetime="2021-06-27T15:55:40+08:00">
	
		    Jun 27, 2021
    	
    </time>
    
        <span>in </span>
        
    <a class="category-link" href="/categories/visualization/">visualization</a>


    
</div>

    
</div>

    
    <div class="post-content markdown">
        <div class="main-content-wrap">
            <img src="https://res.cloudinary.com/chen5349/image/upload/v1624888725/landscape/wp5498288_tkbdrh.jpg" style="zoom:20%;">

<p>This post will introduce how to visualize the continuous variable on the map with the use of choropleth_mapbox, a mighty tool to realize animation.</p>
<span id="more"></span>

<h1 id="table-of-contents">Table of Contents</h1><ol class="toc"><li class="toc-item toc-level-4"><a class="toc-link" href="#Step-1-import-all-needed-packages"><span class="toc-text">Step 1. import all needed packages</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Step-2-import-json-file-from-existing-file"><span class="toc-text">Step 2. import json file from existing file</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Step-3-make-the-json-file-smaller"><span class="toc-text">Step 3. make the json file smaller</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Step-4-Visualization-through-choropleth-mapbox"><span class="toc-text">Step 4. Visualization through choropleth_mapbox</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Step-5-Export-the-image-as-local-html"><span class="toc-text">Step 5. Export the image as local html</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Step-6-Save-the-image-on-plotly-account"><span class="toc-text">Step 6. Save the image on plotly account</span></a></li></ol>

<h4 id="Step-1-import-all-needed-packages"><a href="#Step-1-import-all-needed-packages" class="headerlink" title="Step 1. import all needed packages"></a>Step 1. import all needed packages</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> chart_studio.plotly <span class="keyword">as</span> py</span><br><span class="line"><span class="keyword">import</span> plotly.tools <span class="keyword">as</span> tls</span><br><span class="line"><span class="keyword">import</span> plotly.express <span class="keyword">as</span> px</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> IPython.core.interactiveshell <span class="keyword">import</span> InteractiveShell</span><br><span class="line">InteractiveShell.ast_node_interactivity = <span class="string">&quot;all&quot;</span></span><br></pre></td></tr></table></figure>



<h4 id="Step-2-import-json-file-from-existing-file"><a href="#Step-2-import-json-file-from-existing-file" class="headerlink" title="Step 2. import json file from existing file"></a>Step 2. import json file from existing file</h4><p>The .json file could be converted from shp. file. I convert it directly by using QGIS.</p>
<p>More conveniently, you can use package <strong>shapefile</strong> in python to finish the conversion. Check reference for more detail.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;Simplify_GeoJSON_CHNcity.json&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">  CHN_cities = json.load(f)</span><br><span class="line"><span class="comment"># below is the alternative to load the json file</span></span><br><span class="line"><span class="comment"># CHN_cities = json.load(open(&quot;GeoJSON_CHNcity.geojson&quot;,&quot;r&quot;))</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># examine the fearue of the json file</span></span><br><span class="line">CHN_cities[<span class="string">&quot;features&quot;</span>][<span class="number">0</span>].keys()</span><br><span class="line">CHN_cities[<span class="string">&quot;features&quot;</span>][<span class="number">0</span>][<span class="string">&quot;properties&quot;</span>]</span><br><span class="line">CHN_cities[<span class="string">&quot;features&quot;</span>][<span class="number">0</span>]    </span><br></pre></td></tr></table></figure>

<blockquote>
<p>{‚Äòtype‚Äô: ‚ÄòFeature‚Äô,<br> ‚Äògeometry‚Äô: {‚Äòtype‚Äô: ‚ÄòPolygon‚Äô,<br>  ‚Äòcoordinates‚Äô: [[[116.12962341, 29.82485008],<br>    [116.27577972, 29.79137039],<br>    [116.4651413, 29.90048981],<br>    [116.54703522, 29.9179039],<br>    [116.58567047, 30.05631828],‚Ä¶</p>
</blockquote>
<p>You could find out that the coordinates is in 8 decimal places, which will <strong>inflate the size of the map</strong>. Therefore, we need the following step.</p>
<h4 id="Step-3-make-the-json-file-smaller"><a href="#Step-3-make-the-json-file-smaller" class="headerlink" title="Step 3. make the json file smaller"></a>Step 3. make the json file smaller</h4><ul>
<li><p>First, check If you have large GeoJSON files, such as over 20 or 30 MB. The map upload tends to be slow. And normally could not be uploaded to plotly account. </p>
</li>
<li><p>The easiest way is to use <a target="_blank" rel="noopener" href="https://mapshaper.org/">https://mapshaper.org/</a> to simplify the json file, to make the json file better less than 3MB. You would not lose necessary information because we here care about various coloration across regions.</p>
</li>
<li><p>When you have already finish above two steps, your json file is already small enough. To make it even smaller, run following code to shrink it 10% or so. </p>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#Round off the locations to 2 decimal places (about 1.1 km accuracy)</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(CHN_cities[<span class="string">&quot;features&quot;</span>])):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="built_in">len</span>(CHN_cities[<span class="string">&quot;features&quot;</span>][i][<span class="string">&#x27;geometry&#x27;</span>][<span class="string">&#x27;coordinates&#x27;</span>])):</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            CHN_cities[<span class="string">&quot;features&quot;</span>][i][<span class="string">&#x27;geometry&#x27;</span>][<span class="string">&#x27;coordinates&#x27;</span>][j] = np.<span class="built_in">round</span>(np.array(CHN_cities[<span class="string">&quot;features&quot;</span>][i][<span class="string">&#x27;geometry&#x27;</span>][<span class="string">&#x27;coordinates&#x27;</span>][j]),<span class="number">2</span>)</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            <span class="built_in">print</span>(i,j)</span><br><span class="line">            </span><br><span class="line"><span class="comment"># If you now check the coordinates again, you‚Äôll see that they have been rounded off to 2 decimal places:</span></span><br><span class="line">CHN_cities[<span class="string">&quot;features&quot;</span>][<span class="number">0</span>][<span class="string">&#x27;geometry&#x27;</span>][<span class="string">&#x27;coordinates&#x27;</span>][<span class="number">0</span>][<span class="number">0</span>]</span><br></pre></td></tr></table></figure>

<blockquote>
<p>array([116.13,  29.82])</p>
</blockquote>
<h4 id="Step-4-Visualization-through-choropleth-mapbox"><a href="#Step-4-Visualization-through-choropleth-mapbox" class="headerlink" title="Step 4. Visualization through choropleth_mapbox"></a>Step 4. Visualization through choropleth_mapbox</h4><ul>
<li><p>I have already prepared the df_EC for use, detail cleaning process is omitted here. </p>
</li>
<li><p>We need to ensure that the dataframe df_EC have <em><strong>the same location ‚Äúid‚Äù as geojson file</strong></em>. </p>
</li>
<li><p>Please check the the official websie for setting the parrrameters: <a target="_blank" rel="noopener" href="https://plotly.github.io/plotly.py-docs/generated/plotly.express.choropleth_mapbox.html">https://plotly.github.io/plotly.py-docs/generated/plotly.express.choropleth_mapbox.html</a></p>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">fig_Heterogeneity = px.choropleth_mapbox(df_EC, </span><br><span class="line">                    locations = <span class="string">&quot;id&quot;</span>, </span><br><span class="line">                    geojson = CHN_cities, </span><br><span class="line">                    color = <span class="string">&quot;EC&quot;</span>, </span><br><span class="line">                    mapbox_style=<span class="string">&quot;carto-positron&quot;</span>, <span class="comment"># carto-darkmatter&quot;,</span></span><br><span class="line">                    opacity = <span class="number">0.8</span>,color_continuous_midpoint = <span class="number">0</span>,zoom = <span class="number">2.5</span>,</span><br><span class="line">                    color_continuous_scale = px.colors.diverging.balance,</span><br><span class="line">                    labels=&#123;<span class="string">&#x27;EC&#x27;</span>:<span class="string">&#x27;Environmental Heterogeneity&#x27;</span>&#125;,</span><br><span class="line">                    center=&#123;<span class="string">&quot;lat&quot;</span>: <span class="number">38</span>, <span class="string">&quot;lon&quot;</span>: <span class="number">104</span>&#125;,</span><br><span class="line">                     range_color=(-<span class="number">2.5</span>, <span class="number">1.8</span>) )</span><br><span class="line"><span class="comment">#        zoom = 3,   )</span></span><br><span class="line">fig_Heterogeneity.update_layout(margin=&#123;<span class="string">&quot;r&quot;</span>:<span class="number">0</span>,<span class="string">&quot;t&quot;</span>:<span class="number">0</span>,<span class="string">&quot;l&quot;</span>:<span class="number">0</span>,<span class="string">&quot;b&quot;</span>:<span class="number">0</span>&#125;,height = <span class="number">380</span>, width = <span class="number">759</span>)</span><br><span class="line">fig_Heterogeneity.show()</span><br></pre></td></tr></table></figure>

<p>In the default browser, we get the following image, indicating the environmental complexity across China. </p>
<div>
    <a href="https://plotly.com/~chen5349/31/?share_key=h1E9vkvdUuh6pB7jXfF6ao" target="_blank" title="Environmental Heterogeneity" style="display: block; text-align: center;"><img src="https://plotly.com/~chen5349/31.png?share_key=h1E9vkvdUuh6pB7jXfF6ao" alt="Environmental Heterogeneity" style="max-width: 100%;width: 759px;" width="759" onerror="this.onerror=null;this.src='https://plotly.com/404.png';"></a>
    <script data-plotly="chen5349:31" sharekey-plotly="h1E9vkvdUuh6pB7jXfF6ao" src="https://plotly.com/embed.js" async></script>
</div>



<h4 id="Step-5-Export-the-image-as-local-html"><a href="#Step-5-Export-the-image-as-local-html" class="headerlink" title="Step 5. Export the image as local html"></a>Step 5. Export the image as local html</h4><p>You might want it.. Even though I don‚Äôt think it‚Äôs that useful</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> plotly.io <span class="keyword">as</span> pio</span><br><span class="line">pio.write_html(fig_Heterogeneity, file=<span class="string">&#x27;figure.html&#x27;</span>, auto_open=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure>



<h4 id="Step-6-Save-the-image-on-plotly-account"><a href="#Step-6-Save-the-image-on-plotly-account" class="headerlink" title="Step 6. Save the image on plotly account"></a>Step 6. Save the image on plotly account</h4><ul>
<li><p>The url in the plotly website can help you disseminate your work. The url can also be used in ppt  with animation. I will introduce the embeddment of it in my future blog.</p>
</li>
<li><p>You need to first go the this website for registering account. <a target="_blank" rel="noopener" href="https://chart-studio.plotly.com/feed/#/">https://chart-studio.plotly.com/feed/#/</a></p>
</li>
<li><p>Installation of Chart Studio in python: <a target="_blank" rel="noopener" href="https://plotly.com/python/getting-started-with-chart-studio/">https://plotly.com/python/getting-started-with-chart-studio/</a></p>
</li>
<li><p>Then upload the image to your account</p>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">py.plot(fig_Heterogeneity, filename = &#x27;Environmental Heterogeneity&#x27;, auto_open=True)</span><br></pre></td></tr></table></figure>

<p>It uploads the image online including the data on your plotly account.</p>
<p>If returned with the following error!! Go back to <strong>step 3</strong> to shrink the size.</p>
<blockquote>
<p>‚ÄúThis file is too big! Your current subscription is limited to 524.288 KB uploads. For more information, please visit: <a target="_blank" rel="noopener" href="https://plotly.com/get-pricing/.&quot;">https://plotly.com/get-pricing/.&quot;</a></p>
</blockquote>
<p>Cheers!ü•≥</p>
<p>The following image depicts the environmental dispersion across China. Same steps above can get you this beautiful visualization. </p>
<div>
    <a href="https://plotly.com/~chen5349/33/?share_key=GbkLVug50xwH1jrtw2RWnm" target="_blank" title="Environmental Dispersion" style="display: block; text-align: center;"><img src="https://plotly.com/~chen5349/33.png?share_key=GbkLVug50xwH1jrtw2RWnm" alt="Environmental Dispersion" style="max-width: 100%;width: 759px;" width="759" onerror="this.onerror=null;this.src='https://plotly.com/404.png';"></a>
    <script data-plotly="chen5349:33" sharekey-plotly="GbkLVug50xwH1jrtw2RWnm" src="https://plotly.com/embed.js" async></script>
</div>



<p><strong>References</strong>: </p>
<p><a target="_blank" rel="noopener" href="https://medium.com/tech-carnot/plotly-mapbox-interactive-choropleth-visualization-tutorial-957dcdbca90b">https://medium.com/tech-carnot/plotly-mapbox-interactive-choropleth-visualization-tutorial-957dcdbca90b</a></p>

            


        </div>
    </div>
    <div id="post-footer" class="post-footer main-content-wrap">
        
            <div class="post-footer-tags">
                <span class="text-color-light text-small">TAGGED IN</span><br/>
                
    <a class="tag tag--primary tag--small t-none-link" href="/tags/External-Environment/" rel="tag">External Environment</a> <a class="tag tag--primary tag--small t-none-link" href="/tags/choropleth-mapbox/" rel="tag">choropleth-mapbox</a> <a class="tag tag--primary tag--small t-none-link" href="/tags/plotly/" rel="tag">plotly</a> <a class="tag tag--primary tag--small t-none-link" href="/tags/python/" rel="tag">python</a>

            </div>
        
        
            <div class="post-actions-wrap">
    <nav>
        <ul class="post-actions post-action-nav">
            <li class="post-action">
                
                    
                <a
                    class="post-action-btn btn btn--default tooltip--top"
                    href="/2021/06/28/picture/"
                    data-tooltip="Cloudinary + Hexo"
                    aria-label="PREVIOUS: Cloudinary + Hexo"
                >
                    
                        <i class="fa fa-angle-left" aria-hidden="true"></i>
                        <span class="hide-xs hide-sm text-small icon-ml">PREVIOUS</span>
                    </a>
            </li>
            <li class="post-action">
                
                    <a
                        class="post-action-btn btn btn--disabled"
                        aria-hidden="true"
                    >
                        
                        <span class="hide-xs hide-sm text-small icon-mr">NEXT</span>
                        <i class="fa fa-angle-right" aria-hidden="true"></i>
                    </a>
            </li>
        </ul>
    </nav>
    <ul class="post-actions post-action-share">
        <li class="post-action hide-lg hide-md hide-sm">
            <a
                class="post-action-btn btn btn--default btn-open-shareoptions"
                href="#btn-open-shareoptions"
                aria-label="Share this post"
            >
                <i class="fa fa-share-alt" aria-hidden="true"></i>
            </a>
        </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://www.facebook.com/sharer/sharer.php?u=http://chen5349.github.io/2021/06/27/choropleth-mapbox/"
                    title="Share on Facebook"
                    aria-label="Share on Facebook"
                >
                    <i class="fab fa-facebook" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://twitter.com/intent/tweet?text=http://chen5349.github.io/2021/06/27/choropleth-mapbox/"
                    title="Share on Twitter"
                    aria-label="Share on Twitter"
                >
                    <i class="fab fa-twitter" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://plus.google.com/share?url=http://chen5349.github.io/2021/06/27/choropleth-mapbox/"
                    title="Share on Google+"
                    aria-label="Share on Google+"
                >
                    <i class="fab fa-google-plus" aria-hidden="true"></i>
                </a>
            </li>
        
        
        <li class="post-action">
            
                <a class="post-action-btn btn btn--default" href="#table-of-contents" aria-label="Table of Contents">
            
                <i class="fa fa-list" aria-hidden="true"></i>
            </a>
        </li>
    </ul>
</div>


        
        
    </div>
</article>



                <footer id="footer" class="main-content-wrap">
    <span class="copyrights">
        Copyrights &copy; 2021 Wenna Chen. All Rights Reserved.
    </span>
</footer>

            </div>
            
                <div id="bottom-bar" class="post-bottom-bar" data-behavior="1">
                    <div class="post-actions-wrap">
    <nav>
        <ul class="post-actions post-action-nav">
            <li class="post-action">
                
                    
                <a
                    class="post-action-btn btn btn--default tooltip--top"
                    href="/2021/06/28/picture/"
                    data-tooltip="Cloudinary + Hexo"
                    aria-label="PREVIOUS: Cloudinary + Hexo"
                >
                    
                        <i class="fa fa-angle-left" aria-hidden="true"></i>
                        <span class="hide-xs hide-sm text-small icon-ml">PREVIOUS</span>
                    </a>
            </li>
            <li class="post-action">
                
                    <a
                        class="post-action-btn btn btn--disabled"
                        aria-hidden="true"
                    >
                        
                        <span class="hide-xs hide-sm text-small icon-mr">NEXT</span>
                        <i class="fa fa-angle-right" aria-hidden="true"></i>
                    </a>
            </li>
        </ul>
    </nav>
    <ul class="post-actions post-action-share">
        <li class="post-action hide-lg hide-md hide-sm">
            <a
                class="post-action-btn btn btn--default btn-open-shareoptions"
                href="#btn-open-shareoptions"
                aria-label="Share this post"
            >
                <i class="fa fa-share-alt" aria-hidden="true"></i>
            </a>
        </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://www.facebook.com/sharer/sharer.php?u=http://chen5349.github.io/2021/06/27/choropleth-mapbox/"
                    title="Share on Facebook"
                    aria-label="Share on Facebook"
                >
                    <i class="fab fa-facebook" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://twitter.com/intent/tweet?text=http://chen5349.github.io/2021/06/27/choropleth-mapbox/"
                    title="Share on Twitter"
                    aria-label="Share on Twitter"
                >
                    <i class="fab fa-twitter" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a
                    class="post-action-btn btn btn--default"
                    target="new" href="https://plus.google.com/share?url=http://chen5349.github.io/2021/06/27/choropleth-mapbox/"
                    title="Share on Google+"
                    aria-label="Share on Google+"
                >
                    <i class="fab fa-google-plus" aria-hidden="true"></i>
                </a>
            </li>
        
        
        <li class="post-action">
            
                <a class="post-action-btn btn btn--default" href="#table-of-contents" aria-label="Table of Contents">
            
                <i class="fa fa-list" aria-hidden="true"></i>
            </a>
        </li>
    </ul>
</div>


                </div>
                
    <div id="share-options-bar" class="share-options-bar" data-behavior="1">
        <i id="btn-close-shareoptions" class="fa fa-times"></i>
        <ul class="share-options">
            
                
                
                <li class="share-option">
                    <a
                        class="share-option-btn"
                        target="new"
                        href="https://www.facebook.com/sharer/sharer.php?u=http://chen5349.github.io/2021/06/27/choropleth-mapbox/"
                        aria-label="Share on Facebook"
                    >
                        <i class="fab fa-facebook" aria-hidden="true"></i><span>Share on Facebook</span>
                    </a>
                </li>
            
                
                
                <li class="share-option">
                    <a
                        class="share-option-btn"
                        target="new"
                        href="https://twitter.com/intent/tweet?text=http://chen5349.github.io/2021/06/27/choropleth-mapbox/"
                        aria-label="Share on Twitter"
                    >
                        <i class="fab fa-twitter" aria-hidden="true"></i><span>Share on Twitter</span>
                    </a>
                </li>
            
                
                
                <li class="share-option">
                    <a
                        class="share-option-btn"
                        target="new"
                        href="https://plus.google.com/share?url=http://chen5349.github.io/2021/06/27/choropleth-mapbox/"
                        aria-label="Share on Google+"
                    >
                        <i class="fab fa-google-plus" aria-hidden="true"></i><span>Share on Google+</span>
                    </a>
                </li>
            
        </ul>
    </div>


            
        </div>
        


    
        
    

<div id="about">
    <div id="about-card">
        <div id="about-btn-close">
            <i class="fa fa-times"></i>
        </div>
        
            <img id="about-card-picture" src="https://res.cloudinary.com/chen5349/image/upload/v1624887373/profile_wx71r5.jpg" alt="Author&#39;s picture"/>
        
            <h4 id="about-card-name">Wenna Chen</h4>
        
            <div id="about-card-bio"><p>Public Management Scholar</p>
</div>
        
        
            <div id="about-card-job">
                <i class="fa fa-briefcase"></i>
                <br/>
                <p>PhD</p>

            </div>
        
        
            <div id="about-card-location">
                <i class="fa fa-map-marker-alt"></i>
                <br/>
                Hong kong
            </div>
        
    </div>
</div>

        
            <div id="algolia-search-modal" class="modal-container">
    <div class="modal">
        <div class="modal-header">
            <span class="close-button"><i class="fa fa-times"></i></span>
            <a href="https://algolia.com" target="_blank" rel="noopener" class="searchby-algolia text-color-light link-unstyled">
                <span class="searchby-algolia-text text-color-light text-small">by</span>
                <img class="searchby-algolia-logo" src="https://your.cdn.comhttps://your.img.cdn.com/assets/images/logo-algolia-nebula-blue-full.svg">
            </a>
            <i class="search-icon fa fa-search"></i>
            <form id="algolia-search-form">
                <input type="text" id="algolia-search-input" name="search"
                    class="form-control input--large search-input" placeholder="Search "
                    />
            </form>
        </div>
        <div class="modal-body">
            <div class="no-result text-color-light text-center">no post found</div>
            <div class="results">
                
                <div class="media">
                    
                    <div class="media-body">
                        <a
                            class="link-unstyled"
                            href="http://chen5349.github.io/2021/06/27/choropleth-mapbox/"
                            aria-label=": Visualization - choropleth-mapbox + plotly + python"
                        >
                            <h3 class="media-heading">Visualization - choropleth-mapbox + plotly + python</h3>
                        </a>
                        <span class="media-meta">
                            <span class="media-date text-small">
                                
                                    Jun 27, 2021
                                
                            </span>
                        </span>
                        <div class="media-content hide-xs font-merryweather"><img src="https://res.cloudinary.com/chen5349/image/upload/v1624888725/landscape/wp5498288_tkbdrh.jpg" style="zoom:20%;">

<p>This post will introduce how to visualize the continuous variable on the map with the use of choropleth_mapbox, a mighty tool to realize animation.</p></div>
                    </div>
                    <div style="clear:both;"></div>
                    <hr>
                </div>
                
                <div class="media">
                    
                    <div class="media-body">
                        <a
                            class="link-unstyled"
                            href="http://chen5349.github.io/2021/06/28/picture/"
                            aria-label=": Cloudinary + Hexo"
                        >
                            <h3 class="media-heading">Cloudinary + Hexo</h3>
                        </a>
                        <span class="media-meta">
                            <span class="media-date text-small">
                                
                                    Jun 28, 2021
                                
                            </span>
                        </span>
                        <div class="media-content hide-xs font-merryweather"><img alt itemprop="image" src="https://res.cloudinary.com/chen5349/image/upload/v1624888727/landscape/wp4815672_ywb8si.jpg" style="display: block;">

<p>Try many ways to upload images to hexo under the theme of tranquilpeak, but fail in a day‚Äôs trials. </p>
<p>Only url method works. You can use url directly for gravatar and blog writing.</p></div>
                    </div>
                    <div style="clear:both;"></div>
                    <hr>
                </div>
                
                <div class="media">
                    
                    <div class="media-body">
                        <a
                            class="link-unstyled"
                            href="http://chen5349.github.io/2021/06/30/scatter-mapbox/"
                            aria-label=": scatter_mapbox"
                        >
                            <h3 class="media-heading">scatter_mapbox</h3>
                        </a>
                        <span class="media-meta">
                            <span class="media-date text-small">
                                
                                    Jun 30, 2021
                                
                            </span>
                        </span>
                        <div class="media-content hide-xs font-merryweather"><img src="https://res.cloudinary.com/chen5349/image/upload/v1624888725/landscape/wp4805693_c5oe9e.jpg" style="zoom:30%;">

<p>This post will introduce how to visualize the adoption of innovation (dummy variable) on the map with the use of scatter_mapbox, a mighty tool to realize animation.</p></div>
                    </div>
                    <div style="clear:both;"></div>
                    <hr>
                </div>
                
                <div class="media">
                    
                    <div class="media-body">
                        <a
                            class="link-unstyled"
                            href="http://chen5349.github.io/2021/07/01/Centroid-Polygon-QGIS/"
                            aria-label=": Centroid_Polygon_QGIS"
                        >
                            <h3 class="media-heading">Centroid_Polygon_QGIS</h3>
                        </a>
                        <span class="media-meta">
                            <span class="media-date text-small">
                                
                                    Jul 1, 2021
                                
                            </span>
                        </span>
                        <div class="media-content hide-xs font-merryweather"><img src="https://res.cloudinary.com/chen5349/image/upload/v1624888727/landscape/wp5158977_h6lnva.jpg" style="zoom:40%;">

<p>Centroid refers to the centre point of an object, a polygon, a city. The coordinate of centroid could be useful for mapping the scatter point by using scatter-mapbox. </p>
<p>This post will focus on how to extract its coordinates by using QGIS.</p></div>
                    </div>
                    <div style="clear:both;"></div>
                    <hr>
                </div>
                
                <div class="media">
                    
                    <div class="media-body">
                        <a
                            class="link-unstyled"
                            href="http://chen5349.github.io/2021/07/01/personal-access-token/"
                            aria-label=": personal-access-token"
                        >
                            <h3 class="media-heading">personal-access-token</h3>
                        </a>
                        <span class="media-meta">
                            <span class="media-date text-small">
                                
                                    Jul 1, 2021
                                
                            </span>
                        </span>
                        <div class="media-content hide-xs font-merryweather"><p>Today, I suddenly got this messsage when I deploy my blog to Github.</p>
<blockquote>
<p>remote: Password authentication is temporarily disabled as part of a brownout. Please use a personal access token instead.</p>
<p>remote: Please see <a target="_blank" rel="noopener" href="https://github.blog/2020-07-30-token-authentication-requirements-for-api-and-git-operations/">https://github.blog/2020-07-30-token-authentication-requirements-for-api-and-git-operations/</a> for more information.</p>
</blockquote></div>
                    </div>
                    <div style="clear:both;"></div>
                    <hr>
                </div>
                
            </div>
        </div>
        <div class="modal-footer">
            <p class="results-count text-medium"
                data-message-zero="no post found"
                data-message-one="1 post found"
                data-message-other="{n} posts found">
                5 posts found
            </p>
        </div>
    </div>
</div>

        
        
<div id="cover" style="background-image:url('/assets/images/cover.jpg');"></div>
        <!--SCRIPTS-->

<script src="https://your.cdn.com/assets/js/script-yjkbpewmfwf8f5nmidfxpfmdug8duqckvj5jywsj0nqnqntkds6ltu6wmxsm.min.js"></script>

<!--SCRIPTS END-->




    
<script src="https://your.cdn.com/assets/js/moment-with-locales.js"></script>

    
<script src="https://your.cdn.com/assets/js/algoliasearch.js"></script>

    <script>
      var algoliaClient = algoliasearch('JH5UY0GYSN', '5519233b249e4ba6cb0ee15e3c935aa9');
      var algoliaIndex = algoliaClient.initIndex('algolia_index');
    </script>


    </body>
</html>
